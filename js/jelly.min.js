!function(t,i){"function"==typeof define&&define.amd?define([],i):"object"==typeof module&&module.exports?module.exports=i():t.Jelly=i()}(this,function(){function t(t,i){for(var n in i)t[n]=s.arr(i[n])?i[n].slice(0):i[n];return t}function i(i,n){i||(i={});for(var o=1;o<arguments.length;o++)t(i,arguments[o]);return i}function n(t){var i=0|t.clientWidth,n=0|t.clientHeight;return(t.width!==i||t.height!==n)&&(t.width=i,t.height=n,!0)}function o(t){return{count:0,async:!1,add:function(){this.count++,this.async=!0},check:function(){0==--this.count&&t()},checkNoAsync:function(){this.async||t()}}}function e(){return new function(){this.resolve=null,this.reject=null,this.promise=new Promise(function(t,i){this.resolve=t,this.reject=i}.bind(this))}}function a(t,i){this.canvas=s.str(t)?document.querySelector(t):t,this.ctx=this.canvas.getContext("2d"),this.init(s.arr(i)?i:[i])}var s={arr:function(t){return Array.isArray(t)},str:function(t){return"string"==typeof t},fnc:function(t){return"function"==typeof t}};return a.prototype={defaults:{pathsContainer:document,color:"#666",imageCentroid:!0,debug:!1,pointsNumber:10,mouseIncidence:40,maxIncidence:40,maxDistance:70,dcy:.95,pwr:.025,ent:.25,x:0,y:0},init:function(t){n(this.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this.d=e(),this.promise=this.d.promise,this.initEvents(),this.initOptions(t)},initEvents:function(){var t=this;this.canvas.onmousemove=function(i){i.preventDefault();var n=t.canvas.getBoundingClientRect(),o=i.clientX-n.left,e=i.clientY-n.top,a=o-t.mouseX,s=e-t.mouseY,r=Math.sqrt(a*a*3+s*s*3);r<2&&(r=0),r>100&&(r=100);var h=n.width/t.canvas.offsetWidth,c=n.height/t.canvas.offsetHeight;t.mouseX=o*(1/h),t.mouseY=e*(1/c),t.speed=r?r/10:0},this.canvas.onmouseout=function(i){i.preventDefault(),t.mouseX=void 0,t.mouseY=void 0,t.speed=void 0}},initOptions:function(t){function n(t,n){i(t,{pointsData:a.getPointsData(t),centroid:s.str(t.centroid)?document.querySelector(t.centroid):t.centroid}),a.o[n]=i(t,{centroidPoint:a.getCentroid(t.pointsData)}),t.hidden&&a.animate({animate:!1,i:n},!0)}function e(t,i){if(t.svg){r.add();var o=new XMLHttpRequest;o.open("GET",t.svg),o.overrideMimeType("image/svg+xml"),o.onreadystatechange=function(){if(4===o.readyState){var e=document.implementation.createHTMLDocument("");e.body.innerHTML=200===o.status?o.responseText:"",t.pathsContainer=e,n(t,i),r.check()}},o.send()}else n(t,i)}this.o=[];for(var a=this,r=o(this.initJelly.bind(this)),h=0;h<t.length;h++)e(i({},this.defaults,t[h]),h);r.checkNoAsync()},initJelly:function(){function t(t){n.add();var i=new Image;i.onload=function(){t.image=i,n.check()},i.src=t.image}for(var i=this,n=o(function(){i.d.resolve(),i.renderJelly()}),e=0;e<this.o.length;e++)this.o[e].image&&t(this.o[e]);n.checkNoAsync()},shake:function(t){var n=this;this.promise.then(function(){for(var o,e=i({i:0,x:0,y:0},t),a=n.o[e.i].pointsData,s=0;s<a.length;s++){o=a[s];for(var r=0;r<o.length;r+=2)n.animateShake(o[r],e)}})},animateShake:function(t,i){t.x+=i.x,t.y+=i.y},morph:function(t){var n=this;this.promise.then(function(){for(var o,e,a=i({i:0,maxDelay:0,animate:!0},t),s=n.o[a.i].pointsData,r=n.getPointsData(i(n.o[a.i],a)),h=0;h<s.length;h++){o=s[h],e=r[h];for(var c=0;c<o.length;c++)n.animateMorph(o[c],e[c],a)}})},animateMorph:function(t,i,n){n.animate?setTimeout(function(){t.ox=i.ox,t.oy=i.oy},Math.floor(Math.random()*n.maxDelay)):(t.ox=t.x=i.ox,t.oy=t.y=i.oy)},hide:function(t){var i=this;this.promise.then(function(){i.animate(t,!0)})},show:function(t){var i=this;this.promise.then(function(){i.animate(t,!1)})},animate:function(t,n){var o=i({i:0,maxDelay:0,animate:!0},t);n&&i(o,this.o[o.i].centroidPoint);for(var e,a=this.o[o.i].pointsData,s=0;s<a.length;s++){e=a[s];for(var r=0;r<e.length;r++)n?this.animateHide(e[r],o):this.animateShow(e[r],o)}},animateHide:function(t,i){t.oldX=t.ox,t.oldY=t.oy,i.animate?setTimeout(function(){t.oldX=t.ox,t.oldY=t.oy,t.ox=i.x,t.oy=i.y},Math.floor(Math.random()*i.maxDelay)):(t.ox=t.x=i.x,t.oy=t.y=i.y)},animateShow:function(t,i){setTimeout(function(){t.ox=void 0!==t.oldX?t.oldX:t.ox,t.oy=void 0!==t.oldY?t.oldY:t.oy},Math.floor(Math.random()*i.maxDelay)),i.animate?setTimeout(function(){t.ox=void 0!==t.oldX?t.oldX:t.ox,t.oy=void 0!==t.oldY?t.oldY:t.oy},Math.floor(Math.random()*i.maxDelay)):(t.ox=t.x=void 0!==t.oldX?t.oldX:t.ox,t.oy=t.y=void 0!==t.oldY?t.oldY:t.oy)},getPointsData:function(t){for(var i=s.str(t.paths)?t.pathsContainer.querySelectorAll(t.paths):t.paths,n=[],o=0;o<i.length;o++)n.push(this.getPathPoints(i[o],t));return n},getPathPoints:function(t,n){for(var o,e=t.getTotalLength(),a=n.pointsNumber,s=e/a,r=0,h={xs:0,ys:0},c=[];a--;)o=t.getPointAtLength(r),h.x=o.x+n.x,h.y=o.y+n.y,c.push(i({ox:h.x,oy:h.y},h)),r+=s;return c},calcLoop:function(t,i){var n,o,e,a,s=t.length;for(a=0;a<s;a++){t[a].xs*=i.dcy,t[a].ys*=i.dcy,(t[a].xs>11||t[a].xs<-11)&&(t[a].xs=11*(t[a].xs<0?-1:1)),t[a].xs-=(t[a].x-t[a].ox)*i.pwr,t[a].ys-=(t[a].y-t[a].oy)*i.pwr,t[a].x+=t[a].xs,t[a].y+=t[a].ys;var r=t[a].x-this.mouseX,h=t[a].y-this.mouseY,c=Math.sqrt(r*r+h*h),d=Math.min(i.mouseIncidence*this.speed,i.maxIncidence);c<d&&(t[a].xs=r*d/100,t[a].ys=h*d/100)}var u=s-1;for(a=0;a<s;a++)n=t[u].x-t[a].x,o=t[u].y-t[a].y,e=Math.sqrt(n*n+o*o),e>i.maxDistance&&(t[a].xs+=i.ent*n/e,t[a].ys+=i.ent*o/e,t[u].xs-=i.ent*n/e,t[u].ys-=i.ent*o/e),u=a},renderJelly:function(){this.ctx.clearRect(0,0,this.width,this.height);var t,i,n,o,e,a,s,r;for(s=0;s<this.o.length;s++){for(t=this.o[s],r=0;r<t.pointsData.length;r++)i=t.pointsData[r],this.calcLoop(i,t);for(t.centroidPoint=this.getCentroid(t.pointsData),t.centroid&&(t.centroid.style.transform="translate("+t.centroidPoint.x+"px, "+t.centroidPoint.y+"px)"),r=0;r<t.pointsData.length;r++)this.ctx.save(),i=t.pointsData[r],this.drawPath(i,t),t.hover=this.ctx.isPointInPath(this.mouseX,this.mouseY),this.ctx.clip(),t.image?(e=t.image.width,a=t.image.height,n=t.imageCentroid?t.centroidPoint.x-e/2:0,o=t.imageCentroid?t.centroidPoint.y-a/2:0,this.ctx.drawImage(t.image,n,o,e,a)):(this.ctx.fillStyle=t.color,this.ctx.fill()),this.ctx.restore(),t.debug&&this.drawPoints(i,t)}window.requestAnimationFrame(this.renderJelly.bind(this))},drawPath:function(t){this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);var i,n,o,e=t.length;for(i=0;i<=e;i++)n=t[i>=e?i-e:i],o=t[i+1>=e?i+1-e:i+1],this.ctx.quadraticCurveTo(n.x,n.y,.5*(n.x+o.x),.5*(n.y+o.y));this.ctx.closePath()},drawPoints:function(t,i){for(var n=0;n<t.length;n++)this.drawPoint(t[n]);this.drawPoint(i.centroidPoint)},drawPoint:function(t){this.ctx.beginPath(),this.ctx.arc(t.x,t.y,5,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fillStyle="red",this.ctx.fill()},getCentroid:function(t){var i,n,o,e=0,a=0,s=0;for(i=0;i<t.length;i++)for(o=t[i],e+=o.length,n=0;n<o.length;n++)a+=o[n].x,s+=o[n].y;return{x:a/e,y:s/e}},getHoverIndex:function(){for(var t=0;t<this.o.length;t++)if(this.o[t].hover)return t;return-1}},a});